!function(){"use strict";d3.charts=d3.charts||{},d3.charts.Grid=function(){function a(){e.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function b(a){v.click(a)}function c(a){var b=a.name||"";i.text(b+"@"+[a.x,a.y])}function d(a){a.each(function(d){var n=d[0],o=d[1];e||(k=a[0][0].clientWidth||k,k=k-j.left-j.right,l=a[0][0].clientHeight||l,l=l-j.top-j.bottom,f=d3.select(this).append("svg").attr("width",k).attr("height",l).append("g").attr("transform","translate("+j.left+","+j.right+")").call(u),f.append("rect").attr("width",k).attr("height",l).style("fill","none").style("pointer-events","all"),e=f.append("g"),h=e.append("g").attr("class","tilesLayer"),g=e.append("g").attr("class","botsLayer"),i=f.append("g").attr("class","hover-text").attr("transform","translate(10,20)").append("text").attr({"text-anchor":"start","alignment-baseline":"top",x:0,y:0}).text(""));var v=h.selectAll(".tile").data(n,s);v.enter().append("g").attr("class","tile").attr("transform",function(a){return"translate("+[q(a),r(a)]+")"}).on("click",b).on("mouseenter",c).on("mouseleave",function(){i.text("")}).append("text").attr(t),v.select("text").text(m);var w=g.selectAll(".bot").data(o),x=w.enter().append("g").attr("class",function(a){return"bot bot-"+a.name.toLowerCase()}).on("click",b).on("mouseenter",c).on("mouseleave",function(){i.text("")});x.append("circle").attr({r:1.2*p,cx:0,cy:0}),x.append("text").attr(t),w.attr("class",function(a){return"bot bot-"+a.name.toLowerCase()}).classed("active",function(a){return a.active}).attr("transform",function(a){return"translate("+[q(a),r(a)]+")"}).select("text").text(m)})}var e,f,g,h,i,j={top:-5,right:-5,bottom:-5,left:-5},k=500,l=500,m=_F("t"),n=d3.scale.linear().range([0,k]).domain([0,60]),o=d3.scale.linear().range([0,l]).domain([0,60]),p=n(1),q=_F("x",n),r=_F("y",o),s=function(a){return"@"+[a.x,a.y]},t={"text-anchor":"middle","alignment-baseline":"middle",x:0,y:0},u=d3.behavior.zoom().scaleExtent([.5,10]).on("zoom",a),v=d3.dispatch("click");return d3.rebind(d,v,"on"),d}}(),angular.module("ePrime",["ngAnimate","ngRoute","ngSanitize","ngMessages","ngTouch","debounce","ui.ace","ui.bootstrap","angularMoment","xeditable","cfp.hotkeys","LocalForageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"components/main/main.html",controller:"MainCtrl as main",resolve:{savedGame:["GAME",function(a){return a.load()}]}}).otherwise({redirectTo:"/"})}]).config(["$logProvider","siteConfig",function(a,b){a.debugEnabled(b.debug)}]).config(["hotkeysProvider",function(a){a.includeCheatSheet=!1}]).config(["$localForageProvider","siteConfig",function(a,b){a.config({name:b.name})}]).run(["editableOptions",function(a){a.theme="bs3"}]),angular.module("ePrime").constant("siteConfig",{debug:!1,name:"eprime",version:0}),function(){"use strict";function a(a,b){return(a%b+b)%b}function b(a,b,c){for(var d=0,e=0,f=0;c>f;f++){var g=1/Math.pow(2,f)/4,h=Math.PI/2*g,i=Math.sin(h),j=Math.cos(h),k=a*i+b*j,l=-a*j+b*i;e+=g,d+=g*Math.abs(noise.perlin2(k/g,l/g))}return 2*d/e}function c(a){var b=Math.exp(-a);return function(){for(var a=0,c=Math.random();c>b;)a++,c*=Math.random();return a}}angular.module("ePrime").value("TILES",{EMPTY:String.fromCharCode(0),MOUNTAIN:"#",FIELD:"Â·",MINE:"X",HILL:",",BOT:"A",BASE:"@",HOLE:"O"}).factory("Chunk",function(){function b(a,b,c){Array.isArray(a)?(this.length=a.length,this.size=Math.sqrt(a.length),this.view=new Uint8ClampedArray(a)):(this.size=a,this.length=a*a,this.view=new Uint8ClampedArray(this.length)),this.X=Math.floor(b),this.Y=Math.floor(c),this.hash=0}return b.prototype.id=function(){return this.X+","+this.Y},b.prototype.index=function(b,c){var d=this.size;return b=a(Math.floor(b),d),c=a(Math.floor(c),d),c*d+b},b.prototype.get=function(a,b){return 2===arguments.length&&(a=this.index(a,b)),String.fromCharCode(this.view[a])},b.prototype.set=function(a,b,c){return 3===arguments.length?a=this.index(a,b):c=b,this.view[a]=c.charCodeAt(0),this.hash++,this},b}).factory("World",["$log","TILES","Chunk",function(a,d,e){function f(a,b){this.size=a=a||60,this.seed=b||Math.random(),this.$$chunks={}}function g(a,b,c){return{x:a,y:b,t:c,s:!1}}var h=c(1.26),i=.05;return f.prototype.getHash=function(){return d3.sum(this.$$chunks,_F("hash"))},f.prototype.getChunkId=function(a,b){var c=Math.floor(a/this.size),d=Math.floor(b/this.size);return c+","+d},f.prototype.getChunk=function(b,c){var d=this.getChunkId(b,c),f=this.$$chunks[d];return f||(a.debug("new chunk",d),f=new e(this.size,b/this.size,c/this.size),this.$$chunks[f.id()]=f),f},f.prototype.getIndex=function(a,b){angular.isObject(a)&&(b=a.y,a=a.x);var c=Math.floor(a),d=Math.floor(b);return c%=this.size,d%=this.size,d*this.size+c},f.prototype.getHeight=function(a,c){return noise.seed(this.seed),b((a-30)/this.size,(c-10)/this.size,4)},f.prototype._get=function(a,b){var c=this.getChunk(a,b);return c.get(a,b)},f.prototype._set=function(a,b,c){var d=this.getChunk(a,b);return d.set(a,b,c)},f.prototype.scanTile=function(a,b){var c=this.getChunk(a,b),e=c.get(a,b);if(e===d.EMPTY){var f=this.getHeight(a,b);e=d.FIELD,f>.6?e=d.MOUNTAIN:Math.random()>.98&&(e=d.MINE),c.set(a,b,e)}return{x:a,y:b,t:e,s:!0}},f.prototype.set=function(a,b,c){var d=this.getChunk(a,b);d.set(a,b,c)},f.prototype.get=function(a,b){1===arguments.length&&(b=a.y,a=a.x);var c=this._get(a,b);return c===d.EMPTY?g(a,b,c):this.scanTile(a,b)},f.prototype.scanRange=function(a,b,c){arguments.length<3&&(c=b,b=a.y,a=a.x),c=c||2;for(var d=[],e=a-c;a+c>=e;e++)for(var f=b-c;b+c>=f;f++){var g=Math.sqrt((a-e)*(a-e)+(b-f)*(b-f));if(c>g){var h=this.scanTile(e,f);d.push(h)}}return d},f.prototype._scanList=function(){for(var a=this.size,b=this.size,c=[],e=0;a>e;e++)for(var f=0;b>f;f++){var g=this.get(e,f);null!==g&&g.t!==d.EMPTY&&c.push(g)}return c},f.prototype.scanList=function(a){if(angular.isDefined(a)&&"#.XO".indexOf(a)<0)return[];var b=this.size,c=this.size,e=[];for(var f in this.$$chunks)for(var h=this.$$chunks[f],i=h.X*b,j=h.Y*c,k=i+b,l=j+c,m=i;k>m;m++)for(var n=j;l>n;n++){var o=h.get(m,n);o!==d.EMPTY&&(a&&o!==a||e.push(g(m,n,o)))}return e},f.prototype.dig=function(a,b){if(1===arguments.length&&(b=a.y,a=a.x),this.canMine(a,b)){var c=h();return c>0&&Math.random()<i&&this.set(a,b,d.HOLE),c}return 0},f.prototype.canMine=function(a,b){return this.scanTile(a,b).t===d.MINE},f.prototype.canMove=function(a,b){var c=this.get(a,b);return null!==c&&c.t!==d.MOUNTAIN},f}])}(),function(){"use strict";var a="$bot.unload();\n$bot.charge();\n\nif ($bot.S >=  $bot.mS) {\n  var home = $bot.find('@');\n  $bot.moveTo(home.x,home.y);\n} else if ($bot.E >= 1 && $bot.mine() === false) {\n  var mine = $bot.find('X');\n\n  var x,y;\n  if (mine !== null) {\n     x = mine.x;\n    y = mine.y;\n  } else {\n    x = 2*Math.random()-1+$bot.x;\n    y = 2*Math.random()-1+$bot.y;\n  }\n  $bot.moveTo(x,y);\n}";angular.module("ePrime").constant("defaultScripts",[{name:"Collect",code:a},{name:"Action",code:"$bot.mine();\n$bot.charge();\n$bot.unload();"},{name:"Upgrade",code:"$bot.upgrade();"},{name:"Construct",code:"$bot.construct();"}]).service("aether",function(){var a={executionLimit:1e3,functionName:"tick",functionParameters:["$log","$bot"],problems:{jshint_W040:{level:"ignore"},aether_MissingThis:{level:"ignore"}},noSerializationInFlow:!0,includeFlow:!1,includeMetrics:!1,includeStyle:!1,protectAPI:!1,yieldAutomatically:!0,protectBuiltins:!1};return new Aether(a)}).service("sandBox",["aether",function(a){var b=this,c=function(){console.log.apply(console,arguments)};return b.run=function(b,d){if(null!==b){var e;"object"==typeof b?(b.$method||(a.transpile(b.code),b.$method=a.createMethod()),e=b.$method):(a.transpile(b),e=a.createMethod()),a.depth=1;try{var f=e(c,d);a.sandboxGenerator(f);for(var g=0,h={done:!1};!h.done&&g++<2e5;)h=f.next();if(!h.done)throw new Error("User script execution limit"+g)}catch(i){var j=i.stack||"";return console.log("User script error",i.message,j),i.message}return!0}},b}]).value("isAt",function(a,b,c){return angular.isObject(b)?b.x===a.x&&b.y===a.y:b===a.x&&c===a.y}).factory("Bot",["isAt","TILES","$log","sandBox",function(a,b,c,d){function e(a){var b={};return["name","x","y","S","mS","E","mE"].forEach(function(c){Object.defineProperty(b,c,{get:function(){return a[c]}})}),b}function f(a){function b(b){var c=a.scanList(b);return c.length>0?c[0]:null}var c=e(a);return c.move=function(b,c){return a.move(b,c)},c.moveTo=function(b,c){return a.moveTo(b,c)},c.mine=function(){return a.mine()},c.unload=function(c){var d=b(c||"@");return d?a.unloadTo(d):null},c.charge=function(c){var d=b(c||"@");return d?d.chargeBot(a):null},c.upgrade=function(){a.upgrade()},c.construct=function(b){a.construct(b||null)},c.find=function(a){var c=b(a);return c instanceof g?e(c):c},c.log=function(b){a.addAlert("success",b)},c}function g(a,c,d,e){this.name=a,i=i||e,this.t=b.BOT,this.x=c,this.y=d,this.S=0,this.mS=10,this.dS=1,this.E=0,this.mE=10,this.active=!1,this.halted=!1,this.message="",this.scriptName=null,this.alerts=[],this.$script=null,this.$bot=f(this)}function h(a){var b=i.scripts.filter(p.eq(a));return b.length>0?b[0]:void 0}var i=null,j=Math.sign||function(a){var b=+a;return 0===b?b:Number.isNaN(b)?b:0>b?-1:1};g.prototype.addAlert=function(a,b){this.alerts.push({type:a,msg:b})},g.prototype.closeAlert=function(a){this.alerts.splice(a,1)},g.prototype.clearLog=function(){this.alerts.splice(0)},g.prototype.error=function(a){this.halted=!0,this.addAlert("danger",a)},g.prototype.charge=function(a){var b=this.E;return this.E=+Math.min(b+a,this.mE).toFixed(4),this.E-b},g.prototype.isAt=function(b,c){return a(this,b,c)},g.prototype.mass=function(){return this.mS+this.mE};var k=2;g.prototype.moveCost=function(){return Math.pow(this.mass()/20,k)};var l=.5,m=1,n=2/3,o=l*m/Math.pow(20,n);g.prototype.chargeRate=function(){return o*Math.pow(this.mass(),n)},g.prototype.canMove=function(a,b){a=j(a),b=j(b);var c=Math.max(Math.abs(a),Math.abs(b)),d=this.moveCost()*c;return i.world.canMove(this.x+a,this.y+b)&&this.E>=d},g.prototype.move=function(a,b){a=j(a),b=j(b);var c=Math.max(Math.abs(a),Math.abs(b)),d=this.moveCost()*c;return i.world.canMove(this.x+a,this.y+b)&&this.E>=d?(this.last={x:this.x,y:this.y},this.heading={x:a,y:b},this.x+=a,this.y+=b,this.E-=d,i.world.scanRange(this),!0):!1},g.prototype.canMoveTo=function(a,b){angular.isObject(a)&&(b=a.y,a=a.x);var c=a-this.x,d=b-this.y;return this.canMove(c,d)},g.prototype.moveTo=function(b,c){this.target={x:b,y:c},angular.isObject(b)&&(c=b.y,b=b.x);for(var d=b-this.x,e=c-this.y,f=0;7>f;f++){if(d=j(d),e=j(e),(!this.obs||!a(this.last,this.x+d,this.y+e))&&this.move(d,e))return this.obs=f>0,!0;var g=d+e;e-=d,d=g}return!1},g.prototype.canMine=function(){return i.world.get(this).t===b.MINE&&this.E>=1&&this.S<this.mS?!0:!1},g.prototype.mine=function(){if(i.world.get(this).t===b.MINE&&this.E>=1&&this.S<this.mS){this.E--;var a=i.world.dig(this);return a=this.load(a),i.stats.S+=a,a}return!1},g.prototype.load=function(a){var b=this.S;return this.S=Math.min(b+a,this.mS),this.S-b},g.prototype.unload=function(){var a=this.S;return this.S=0,a};var p=_F("name");return g.prototype.setCode=function(a){return null===a?(this.scriptName=null,this.$script=null,null):("string"==typeof a&&(a=h(a)),a?(this.scriptName=a.name,this.$script=a,this.message="",a):void c.error("Script not found"))},g.prototype.run=function(){this.message="",this.manual=!1},g.prototype.stop=function(){this.manual=!0},g.prototype.takeTurn=function(a){if(i.stats.E+=this.charge(this.chargeRate()*a),null!==this.scriptName&&this.halted===!1){var b=this.setCode(this.scriptName),c=d.run(b,this.$bot);c!==!0&&this.error(c)}},g.prototype.chargeBot=function(b){if(a(b,this)){var c=Math.min(10,this.E);return c=b.charge(c),this.E-=c,c}return!1},g.prototype.unloadTo=function(b){if(a(b,this)){var c=this.unload(),d=b.load(c);return this.load(c-d),d}return 0},g.prototype.canUpgrade=function(){return this.S>=10},g.prototype.upgrade=function(){this.S>=10&&(this.S-=10,this.mS+=10,this.mE+=10,this.mS>=100&&(this.t=b.BASE))},g.prototype.canConstruct=function(){return this.S>=100},g.prototype.construct=function(a){if(this.S>=100){var b=new g("Rover",this.x,this.y);return b.scriptName=a||null,b.$home=this,this.S-=100,i.bots.push(b),b}return null},g.prototype.canRelocate=function(){return this.E>=500},g.prototype.scan=function(){return i.world.scan(this)},g.prototype.scanList=function(a){var b=this,c=i.scanList(a).filter(function(a){return a!==b});return 0===c.length?[]:(c.forEach(function(a){var c=a.x-b.x,d=a.y-b.y;a.r=Math.max(Math.abs(c),Math.abs(d))}),c.sort(function(a,b){return a.r-b.r}))},g}])}(),function(){"use strict";function a(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function b(a){var b={};for(var c in a)a.hasOwnProperty(c)&&"$"!==c.charAt(0)&&(b[c]=a[c]);return b}angular.module("ePrime").service("GAME",["$log","$localForage","World","Bot","Chunk","TILES","defaultScripts",function(c,d,e,f,g,h,i){var j=this;j.scripts=angular.copy(i),j.scanList=function(a){function b(b){return b.t===a||b.name===a}var c=a?this.bots.filter(b):this.bots,d=this.world.scanList(a);return d.concat(c)},j.save=function(){var a={};angular.forEach(j.world.$$chunks,function(b,c){a[c]={X:b.X,Y:b.Y,view:Array.prototype.slice.call(b.view)}});var e={stats:b(j.stats),world:b(j.world),bots:j.bots.map(b),scripts:j.scripts.map(b),chunks:a};return d.setItem("saveGame",e).then(function(){c.debug("saved")})},j.load=function(){return d.getItem("saveGame").then(function(a){return a?(c.debug("game loaded",arguments),angular.extend(j.world,a.world),angular.copy(a.scripts,j.scripts),angular.extend(j.stats,a.stats),j.world.$$chunks={},angular.forEach(a.chunks,function(a,b){j.world.$$chunks[b]=new g(a.view,a.X,a.Y)}),void a.bots.forEach(function(a,b){var c=j.bots[b];c||(c=new f("",0,1,j),j.bots.push(c)),angular.extend(c,a)})):c.debug("saveGame not found")})},j.clear=function(){var a={stats:{},world:{},bots:[],scripts:j.scripts.map(b),chunks:[]};return d.setItem("saveGame",a)},j.reset=function(){j.world?j.world.$$chunks={}:j.world=new e(60);var a=new f("Base",30,10,j);return a.active=!0,a.S=a.mS=100,a.E=a.mE=100,a.t=h.BASE,j.bots=[a],j.world.scanRange(a),"X"===j.world._get(a.x,a.y)&&j.world._set(a.x,a.y,h.FIELD),j.stats={E:0,S:0,turn:0,start:new Date},j},j.takeTurn=function(){a(j.bots.slice(0)).forEach(function(a){a.takeTurn(1)}),j.stats.turn++,j.stats.turn%20===0&&j.save()},j.reset()}])}(),function(){"use strict";angular.module("ePrime").controller("MainCtrl",["$scope","$compile","$log","$route","$window","$timeout","$modal","hotkeys","debounce","modals","siteConfig","isAt","sandBox","TILES","GAME",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){c.debug("d3 draw");var a=o.world.scanList(),b=o.bots;d3.select("#grid").datum([a,b]).call(v)}function q(){u.cheat=!1,u.game=o,u.bot=o.bots[1]}function r(){t(),o.clear().then(function(){e.location.reload()})}function s(a,b){var c=u.dT;u.play(0),h.pause(),j.pauseConfirm(a,b).result.then(r,function(){o.save(),u.play(c),h.unpause()})}function t(){angular.isDefined(x)&&f.cancel(x)}var u=this,v=(new d3.charts.Grid).on("click",function(b){a.$apply(function(){o.bots.forEach(function(a){a.active=a===b,a.active&&(u.bot=a)})})});u.drawWatch=function(){for(var a=""+o.world.getHash(),b=o.bots.length,c=0;b>c;c++){var d=o.bots[c],e=o.world.getIndex(d);a+=d.t+e+(d===u.bot?"!":"")}return a},a.$watch(u.drawWatch,i(p)),u.canMine=function(a){return a=a||u.bot,o.world.get(a.x,a.y).t===n.MINE},u.toggleBot=function(a,b){arguments.length<2&&(b=a.manual),a=a||u.bot,b?a.run():a.stop()},u.canUnload=function(a){return a=a||u.bot,a.S<=0?!1:u.game.bots.some(function(b){return"@"===b.t&&l(b,a)&&b.S<b.mS})},u.canCharge=function(a){return a=a||u.bot,a.E>=a.mE?!1:u.game.bots.some(function(b){return"@"===b.t&&b.E>0&&l(b,a)})},u.canAction=function(a){return a=a||u.bot,a.canMine()||u.canUnload(a)||u.canCharge(a)},u.action=function(a){a=a||u.bot,a.$bot.unload(),a.$bot.charge(),a.mine()},u.run=function(a){var b=m.run(a,u.bot.$bot);b!==!0&&u.bot.error(b)},k.debug&&h.bindTo(a).add({combo:"f",callback:function(){u.cheat=!0,o.bots.forEach(function(a){a.E=a.mE})}}).add({combo:"g",callback:function(){u.cheat=!0,u.game.world.scanRange(u.bot.x,u.bot.y,40),p()}});var w=[["q","NW",-1,-1],["w","N",0,-1],["e","NE",1,-1],["a","W",-1,0],["d","E",1,0],["z","SW",-1,1],["x","S",0,1],["c","SE",1,1]];w.forEach(function(b){h.bindTo(a).add({combo:b[0],callback:function(){u.bot.move(b[2],b[3])}})}),h.bindTo(a).add({combo:"s",description:"Action (Unload/load/mine)",callback:function(){u.action()}}).add({combo:"j k",description:"Prev/next bot"}).add({combo:"?",description:"Show / hide this help menu",callback:function(){u.help()}}),u.reset=function(){s('<h1 class="text-center">Are you sure?<h1>',!0)},u.relocate=function(a){a.canRelocate()&&s('<h1 class="text-center">Congratulations<h1><h3 class="text-center">You have set off to explore another planet.</h3>',!0)},u.help=function(){var a=u.dT;u.play(0),h.pause(),j.openHelp().result.then(null,function(){u.play(a),h.unpause()})},u.save=function(){o.save().then(function(){s('<h1 class="text-center">Game saved.<h1><h4 class="text-center">You can safely close this tab<h4>',!1)})},u.pause=function(){s("",!1)},u.showScripts=function(a){function b(){o.save(),u.play(c)}"string"==typeof a&&o.scripts.forEach(function(b,c){b.name===a&&(a=c)});var c=u.dT;u.play(0),g.open({templateUrl:"components/editor/editor.html",size:"lg",backdrop:"static",controller:"EditorCtrl as editor",resolve:{initialScriptId:function(){return a}}}).result.then(b,b)},q(),p(),u.dT=0;var x;u.takeTurn=function(){t(),o.takeTurn(),u.dT>0&&(x=f(u.takeTurn,u.dT))},u.play=function(a){t(),u.dT=a,a>0&&u.takeTurn()},a.$on("$destroy",function(){console.log("destroy"),t()})}])}(),function(){"use strict";angular.module("ePrime").directive("botPanel",function(){return{restrict:"A",scope:!0,templateUrl:"components/panels/bot-panel.html",compile:function(a,b){return function(a,c,d){a.bot=a.$parent.$eval(b.botPanel),a.showControls=angular.isDefined(d.showControls)&&a.$parent.$eval(b.showControls),a.$parent.$watch(b.botPanel,function(b){a.bot=b}),a.checkName=function(a){return a.length<3?"Units name must contain at least three characters":!0}}}}})}(),function(){"use strict";angular.module("ePrime").service("modals",["$modal",function(a){var b=this;return b.pauseConfirm=function(b,c){return a.open({templateUrl:"components/modals/confirm-model.html",backdrop:"static",keyboard:!0,size:"lg",controller:"ConfirmInstanceCtrl",resolve:{data:function(){return{message:b,showReset:c}}}})},b.openHelp=function(){return a.open({templateUrl:"components/modals/help-model.html",backdrop:"static",keyboard:!0,size:"lg",controller:"HelpInstanceCtrl"})},b}]).controller("HelpInstanceCtrl",["$scope","hotkeys",function(a,b){a.hotkeys=b}]).controller("ConfirmInstanceCtrl",["$scope","data","GAME",function(a,b,c){a.game=c,a.message=b.message,a.showReset=b.showReset}])}(),function(){"use strict";function a(a,b){var c=this;a.page=1,a.item=a.openItem,a.opened=!1,a.search={name:""},a.select=function(b){a.openItem=a.item=b,a.items.forEach(function(a){a.active=a===b})},a.open=c.open=function(b){a.select(b),a.page=a.items.indexOf(b)+1,a.opened=!0},a.pageChanged=function(b){var c=a.items[b-1];a.select(c)},a.close=function(){a.opened=!1},b.bindTo(a).add({combo:"k",callback:function(){a.page=Math.min(a.page+1,a.items.length),a.pageChanged(a.page)}}).add({combo:"j",callback:function(){a.page=Math.max(a.page-1,1),a.pageChanged(a.page)}})}a.$inject=["$scope","hotkeys"],angular.module("ePrime").controller("ListController",a).directive("slidingListInject",function(){return{require:"^slidingList",link:function(a,b,c,d,e){var f=d.parent.$new();f[d.valueKey]=a.item,f.opened=a.opened,f.open=d.open,a.$watch("item",function(a){f[d.valueKey]=a}),e(f,function(a){b.empty(),b.append(a),b.on("$destroy",function(){f.$destroy()})})}}}).directive("slidingList",function(){return{restrict:"AE",transclude:!0,scope:{openItem:"=item"},controller:"ListController",templateUrl:"components/list/list-template.html",link:function(a,b,c,d){var e=c.slidingList,f=e.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),g=f[1],h=f[2];a.items=a.$parent.$eval(h),d.parent=a.$parent,d.valueKey=g}}})}(),function(){"use strict";angular.module("ePrime").controller("EditorCtrl",["$log","$modalInstance","initialScriptId","defaultScripts","GAME","aether",function(a,b,c,d,e,f){function g(){var a=h.scripts.map(_F("name"));h.scripts.forEach(function(b,c){for(b.name;a.indexOf(b.name)<c;)b.name=a[c]=b.name+"*"})}var h=this;h.set=function(a){h.script=a},h.reset=function(a){a&&(a.$setPristine(),a.$setUntouched(),a.code.$error={}),h.scripts=angular.copy(e.scripts),h.script=h.scripts[c||0]},h.resetToDefaultScripts=function(){d.forEach(function(a){for(var b=0;b<h.scripts.length;b++)if(h.scripts[b].name===a.name)return void angular.copy(a,h.scripts[b]);h.scripts.push(angular.copy(a))})},h["new"]=function(a,b){a=a||"new",b=b||"$log($bot.name, $bot.x, $bot.y);",h.script={name:a,code:b},h.scripts.push(h.script),g()},h["delete"]=function(a){var b=h.scripts.indexOf(a);h.scripts.splice(b,1),h.script===a&&(h.script=h.scripts[b<h.scripts.length?b:0])},h.update=function(a,b){b.code.$error.syntaxError=!1,a.code&&a.code.length>0&&(f.transpile(a.code),f.problems.errors.length>0&&(b.code.$error.syntaxError=f.problems.errors.map(_F("message")).join("\n")))},h.save=function(){g(),e.scripts=angular.copy(h.scripts),e.scripts.forEach(function(a){a.$method=null}),b.close()},h.aceLoaded=function(a){var b=a.getSession();b.setUndoManager(new ace.UndoManager),b.setTabSize(2)},h.reset()}])}();